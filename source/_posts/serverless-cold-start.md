---
title: Serverless cold start å•é¡Œ
categories: Serverless
tags:
  - AWS
  - GCP
  - Azure
  - Heroku
  - cold start
abbrlink: 3995325371
date: 2020-02-16 01:30:03
---

![workload](https://i.imgur.com/gjLODpG.jpg)

# å‰è¨€

ä¹‹å‰éµäººè³½å¯«äº†ä¸€ç¯‡æ–‡ç« æœ‰æåˆ° [Cold Start çš„å•é¡Œ](https://nijialin.com/2019/10/14/Day30-%E8%80%81%E6%98%AF%E5%9C%A8%E5%90%B9-Serverless%EF%BC%8C%E4%BB%96%E7%9C%9F%E7%9A%84%E6%9C%89%E9%82%A3%E9%BA%BC%E5%A5%BD%EF%BC%9F/)ï¼Œä¸éåªæœ‰ç²—ç•¥ä»‹ç´¹ï¼Œæœ€è¿‘çœ‹åˆ°å¤§å®¶å¿½ç„¶åˆé–‹å§‹è¨è«–é€™å€‹è©±é¡Œï¼Œé€™æ¬¡å°±ä¾†å¥½å¥½çš„æœå°‹è³‡æ–™ä»‹ç´¹ä¸€ä¸‹ã€‚

å¹³å¸¸åœ¨åš open source æ™‚æ¯”è¼ƒå¸¸é‡åˆ°ä¼‘çœ ç‹€æ…‹æ‡‰è©²å°±æ˜¯ `Heroku`ï¼Œè€Œé–‹é ­è¦å…ˆæ¾„æ¸…ä¸€ä¸‹ä»–æ˜¯å±¬æ–¼ `PaaS` çš„æ¶æ§‹ï¼Œè€Œ AWSã€Googleã€Azure è£¡æä¾›çš„ `Lambda`ã€`Cloud Run`ã€`Azure Function` é€™äº›å‰‡å±¬æ–¼ FaaS æ¶æ§‹ï¼Œè€Œæœ€å¸¸è¨è«– `Cold start` æ™‚æœ€å¸¸æœƒåœ¨ FaaS ä¸Šè¨è«–ï¼Œåªæ˜¯å‰›å¥½ Heroku ä½¿ç”¨èµ·ä¾†ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œé€™æ¬¡æ–‡ç« å°±æŠŠä»–ä¸€èµ·æŠ“é€²ä¾†è¨è«–å•¦ï½

> æœ‰å¾ˆå¤šå„å¼å„æ¨£çš„æœå‹™ï¼ŒSaaSã€FaaSã€KaaSã€IaaS... ç­‰å„å¼å„æ¨£çš„æ¶æ§‹ï¼Œæ¯å€‹éƒ½æ˜¯ç‚ºäº†è§£æ±ºæŸå€‹å•é¡Œæ‰€èª•ç”Ÿçš„ï¼Œè‡³æ–¼å¥½æˆ–ä¸å¥½å…¶å¯¦å°±æ˜¯çœ‹ä½¿ç”¨å ´æ™¯è€Œå®šï¼Œæ‰€ä»¥å¤§å®¶åœ¨é¸ç”¨æ™‚è¦æ³¨æ„ä¸€ä¸‹ä½ ä½¿ç”¨çš„å ´æ™¯å“¦ï¼

# ç‚ºä»€éº¼æœƒä¼‘çœ 

ä¸€èˆ¬æœƒæœ‰ä¼‘çœ æ©Ÿåˆ¶æ˜¯å› ç‚ºé€™äº›ä¾›æ‡‰å•†åœ¨æä¾›æœå‹™éƒ½æ˜¯æä¾›æŒ‰æ¬¡è¨ˆè²»çš„æ–¹æ¡ˆï¼Œè®“é–‹ç™¼è€…åœ¨ç”¨æ™‚å¯ä»¥éœ€è¦æ‰å–šé†’ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯èªªé€™äº›æœå‹™éƒ½æ˜¯ `äº‹ä»¶é©…å‹•`(`Event-Driven`)å°å‘ï¼Œæ„æŒ‡æ˜¯ç•¶å‰æœå‹™è‹¥æ”¶åˆ°è¨Šæ¯å¾Œï¼Œæœƒå‘¼å«å°æ‡‰çš„ Function ä¾†è™•ç†å°æ‡‰æœå‹™æ‰€æ¥æ”¶åˆ°çš„è³‡æ–™(Queueã€Notify ...)ï¼Œä½†ç›¸å°çš„å°±æ˜¯æœƒæœ‰`ä¼‘çœ `è®“æœå‹™æš«åœï¼Œé€²è€Œè®“è¼ƒå°‘ä½¿ç”¨çš„æœå‹™ä¸æœƒå› ç‚ºæ›åœ¨ç·šä¸Šè€Œä¸€ç›´è¢«æ”¶è²»ç”¨ï¼Œè€Œé‡æ–°å•Ÿå‹•é€™ä»¶äº‹å°±æ˜¯æœ¬ç¯‡è¦æçš„`Cold start`ã€‚

# Cold start æµç¨‹

åœ¨è™•ç†è³‡æ–™ä¹‹å¾Œéä¸€æ®µæ™‚é–“è‹¥æ²’æœ‰ç¹¼çºŒåŸ·è¡Œï¼Œé›²ç«¯ä¾›æ‡‰å•†æœƒå°‡æ¨¡çµ„æš«åœï¼Œæ­¤æ™‚ function æœƒè™•æ–¼ inactive ç‹€æ…‹(cold)ï¼Œè€Œç•¶ function å†åº¦è¢«è§¸ç™¼æ™‚(`cold start`)å‰‡æœƒå†å•Ÿå‹•æ¨¡çµ„ä¾†åŸ·è¡Œå°æ‡‰ function ä¾†è™•ç†äº‹ä»¶ï¼Œåœ¨æ¨¡çµ„èˆ‡ function ä¹‹é–“çš„é—œä¿‚å¯ä»¥ç¨±ä»–å€‘ç‚º `Function chain`ã€‚

### ä¼‘çœ ç‹€æ…‹å–šé†’æµç¨‹

![[åƒè€ƒ](https://mikhail.io/2018/08/serverless-cold-start-war/#how-do-languages-compare-)](https://i.imgur.com/DQoGYns.png)

ä»¥ AWS ç‚ºä¾‹ï¼Œåœ¨å–šé†’æ™‚æœƒåˆ° S3 å»å–å¾—æª”æ¡ˆï¼Œæ¥è‘—æ‰¾åˆ°ç›¸é—œçš„ Lambda ä¸¦è¼‰å…¥ç›¸é—œæ¨¡çµ„å¥—ä»¶ï¼Œç„¶å¾Œå†åŸ·è¡Œè§¸ç™¼çš„äº‹ä»¶ï¼Œæ•´ç†éå¾Œçš„ä¸‹:

> äº‹ä»¶è™•ç† â¡ï¸ éæ®µæ™‚é–“ â¡ï¸ æš«åœ function æ¨¡çµ„(ä¼‘çœ ) â¡ï¸ è§¸ç™¼ â¡ï¸ å•Ÿå‹• function æ¨¡çµ„ â¡ï¸ äº‹ä»¶è™•ç†...

é€™æ•´å€‹æµç¨‹å°±æ˜¯ä¿—ç¨±çš„ `cold start`ï¼Œå› ç‚ºåœ¨é€™å€‹éç¨‹ä¸­æœƒèŠ±äº›æ™‚é–“ï¼Œæ‰€ä»¥è‹¥æ˜¯æ‹¿ä¾†è™•ç† api ç›¸é—œå•é¡Œçš„è©±å°±æœƒæœ‰ç¬¬ä¸€æ‰¹è«‹æ±‚å¾ˆä¹…ï¼Œç„¶å¾Œä¹‹å¾Œçš„è«‹æ±‚å»ç‰¹åˆ¥å¿«çš„ç‹€æ…‹ï¼Œè«‹å¤§å®¶è«æ€¥è«æ…Œè«å®³æ€•å‘€ï¼

# å¹³å°æ¯”è¼ƒè¡¨

| å¹³å°                   | å¤šå°‘æ™‚é–“å¾Œæš«åœ                                                                                 |
| ---------------------- | ---------------------------------------------------------------------------------------------- |
| AWS Lambda             | 10 minutes                                                                                     |
| Google Cloud Functions | [ä»‹æ–¼ 3 minutes ä¹‹é–“ 5+ hours éƒ½æœ‰](https://mikhail.io/2018/08/serverless-cold-start-war/#gcp) |
| Azure Functions        | [20 minutes](https://mikhail.io/2018/08/serverless-cold-start-war/#azure)                      |
| Heroku                 | [30 minutes](<(https://devcenter.heroku.com/articles/free-dyno-hours#dyno-sleeping)>)          |

> å‰ä¸‰å€‹ç‚º `FaaS` æ¶æ§‹ï¼Œè€Œ Heroku å‰‡ç‚º `PaaS` æ¶æ§‹å–”ï¼

ä¸‹åœ–å‰‡ä¾†è‡ª 2019/09 çš„[ä¸€ç¯‡æ–‡ç« ](https://mikhail.io/serverless/coldstarts/big3/)ï¼Œè¼ƒæ·±è‰²çš„éƒ¨åˆ†å‰‡ç‚ºå•Ÿå‹•æ™‚é–“ã€‚
![FaaS platform cold start time](https://i.imgur.com/yZxWvlL.png)

# å¦‚ä½•è™•ç†æˆ–æ˜¯ç›¡å¯èƒ½é¿å…ï¼Ÿ

ä»¥æˆ‘ç†Ÿæ‚‰ä½¿ç”¨ [serverless framework](https://serverless.com/) éƒ¨ç½²åˆ° AWS ä¾†èªªï¼Œä»–å€‘æä¾›äº†ä¸€å€‹ [warm-up](https://serverless.com/plugins/serverless-plugin-warmup/) çš„å¥—ä»¶ï¼Œå¯ä»¥è¨­å®šæ’ç¨‹æ™‚é–“è®“é€™å€‹ function å›ºå®šå»æˆ³å…¶ä»– functionï¼Œé¿å…ä»–å€‘é€²å…¥ä¼‘çœ çš„ç‹€æ…‹ï¼Œé›–ç„¶é€™æ¨£å­å°±èƒ½é”åˆ°è·Ÿä¸€èˆ¬æœå‹™ä¸€æ¨£çš„å¸¸é§ç‹€æ…‹ï¼Œä¸éç›¸å°ä¾†èªªå°±è¦æ³¨æ„æ¬¡æ•¸çš„ä½¿ç”¨å•é¡Œï¼Œè‹¥æ˜¯æµé‡é‚„å°çš„è©±æ²’ä»€éº¼å•é¡Œï¼Œä½†è‹¥æœ‰ä¸€å®šçš„æµé‡å°±é ˆæ³¨æ„ä¸€ä¸‹å¸³å–®ï¼Œå› ç‚ºé€™äº›åœ¨äº’æˆ³çš„éç¨‹ä¸­é‚„æ˜¯æœ‰ç®—é€²è²»ç”¨çš„å–”ï¼ä½¿ç”¨ä¸Šé‚„è¦å¤šæ³¨æ„æ‰è¡Œã€‚

å¦ä¸€æ–¹é¢è¦æ³¨æ„ç›¸ä¾å¥—ä»¶çš„å•é¡Œï¼Œå¼•ç”¨ google [æ–‡ä»¶çš„å…¶ä¸­ä¸€æ®µ](https://cloud.google.com/run/docs/tips#optimizing_performance):

è¬¹æ…ä½¿ç”¨ä¾é™„å…ƒä»¶ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å‹•æ…‹èªè¨€æ­é…ç›¸ä¾çš„ç¨‹å¼åº«ï¼Œä¾‹å¦‚åŒ¯å…¥ä½¿ç”¨ Node.js çš„æ¨¡å‹ï¼Œé€™äº›æ¨¡çµ„çš„è¼‰å…¥æ™‚é–“æœƒå¢åŠ å†·å•Ÿå‹•æœŸé–“çš„å»¶é²æ™‚é–“ã€‚æ‚¨å¯ä»¥é€éä»¥ä¸‹æ–¹å¼ç¸®çŸ­å•Ÿå‹•å»¶é²æ™‚é–“ï¼š

- å„˜å¯èƒ½æ¸›å°‘ç›¸ä¾å…ƒä»¶çš„æ•¸é‡å’Œå¤§å°ä»¥å»ºç½®ç²¾ç°¡çš„æœå‹™ã€‚
- åªæœ‰åœ¨å¿…è¦æ™‚æ‰è¼‰å…¥ä¸å¸¸ç”¨çš„ç¨‹å¼ç¢¼ (å¦‚æœæ‚¨ä½¿ç”¨çš„èªè¨€æ”¯æ´)ã€‚
- ä½¿ç”¨ç¨‹å¼ç¢¼è¼‰å…¥çš„æœ€ä½³åŒ–ï¼Œä¾‹å¦‚ PHP çš„ composer è‡ªå‹•è¼‰å…¥å™¨æœ€ä½³åŒ–ã€‚

> ç•¢ç«Ÿåœ¨è¼‰å…¥æ¨¡çµ„çš„æ™‚å€™ç›¸ä¾å¥—ä»¶ä¹Ÿæ˜¯è¦ä¸€èµ·æŠ“é€²ä¾†ï¼Œè‹¥æ˜¯ç¨‹å¼æœ¬èº«å¤ªå¤šä¾è³´çš„è©±ä¹Ÿæ˜¯æœƒå°è‡´ cold start çš„æ™‚é–“è®Šé•·å“¦ï¼

æœ€å¾Œå°±åœ¨å¹«å¤§å®¶æ•´ç†ä¸€ä¸‹ä¸‰å¤§å¹³å°çš„ warm-up è³‡æºï¼š

- [warm-up](https://serverless.com/plugins/serverless-plugin-warmup/)
- [Google App Engine warm up](https://cloud.google.com/appengine/docs/standard/python/configuring-warmup-requests)
- [Google Schedule](https://www.serverlessnotes.com/docs/scheduling-with-azure-functions)
- [Scheduling with Azure Functions](https://www.serverlessnotes.com/docs/scheduling-with-azure-functions)

# çµè«–

ç‚ºä»€éº¼è¦æœ‰ cold start çš„æ©Ÿåˆ¶ï¼Œä»¥ä¾›æ‡‰å•†çš„è§’åº¦ä¾†èªªä»–å€‘å¯ä»¥æä¾›ä¸€å®šçš„é‡è®“ä½¿ç”¨è€…å…è²»åœ¨å¹³å°ä¸Šå…ˆå»ºç½®æœå‹™ï¼Œä½†è‹¥è¦å…è²»å°±æ˜¯æœå‹™æœƒè¢«æš«æ™‚æš«åœï¼Œç•¢ç«Ÿç¾åœ¨æµé‡å°±æ˜¯éŒ¢å— ğŸ’°ï¼Œåƒæˆ‘å¸¸ç”¨çš„ Heroku å°±æœƒæ˜¯é€™æ¨£ï¼Œè€Œç•¶ä½ æµé‡å¤§çš„æ™‚å€™å°±çœ‹ä½ è¦ä¸è¦æ¬å®¶ï¼Œä¸éä¸€èˆ¬æ‡‰è©²éƒ½æ‡¶å¾—æ¬ï¼Œå°±æœƒå½¢æˆæ‰€è¬‚çš„`é¤Šã€å¥—ã€æ®º`ğŸ¤£(é›¢é¡Œ)ã€‚

ç¸½è€Œè¨€ä¹‹ï¼Œè‹¥æ˜¯éœ€è¦æœå‹™æ™‚å¸¸æ´»è‘—ï¼Œå°±æ˜¯éœ€è¦ä»˜å‡ºé»æµé‡çš„éŒ¢ ğŸ’°ï¼Œä¹Ÿæˆ–è¨±ä½ çš„ä½œå“æœå‹™æ™‚é–“å¯èƒ½ä¸ç”¨é‚£éº¼é•·ï¼Œåªè¦åœ¨æœå‹¤æ™‚é–“å…§é•·é§æ´»è‘—å°±å¯ä»¥åœ¨çœä¸‹ä¸€äº›è²»ç”¨ï¼Œå¦‚æœæœ‰éœ€è¦çš„è©±é‚„æ˜¯ä»˜ä¸€äº›éŒ¢çµ¦ä¾›æ‡‰å•†ï¼Œç•¢ç«Ÿäººå®¶ä¹Ÿå¹«ä½ ä¿ç®¡äº†æœå‹™ä½ èªªæ˜¯ä¸æ˜¯ï¼Ÿ

# åƒè€ƒ

- [On the Serverless cold start problem](https://medium.com/faun/on-the-serverless-cold-start-problem-2fc0797da5cc)
- [Lambda Warm-up](https://serverless.com/blog/keep-your-lambdas-warm/#installing-the-warmup-plugin)
- [Heroku cold start](https://devcenter.heroku.com/articles/free-dyno-hours)
- [serverless å•Ÿå‹•æµç¨‹](https://mikhail.io/2018/08/serverless-cold-start-war/#how-do-languages-compare-)
- [Function Chain ä¾†æº](https://www.nuweba.com/blog/when-are-cold-starts-problem)
- [cloud run cold start](https://github.com/ahmetb/cloud-run-faq#cold-starts)
